{%- liquid
  assign safe_items = items
  if safe_items == nil
    assign safe_items = empty
  endif
-%}

{%- comment -%}Performance: hard cap in Liquid too{%- endcomment -%}
{%- assign rendered_count = 0 -%}

{%- if mode == 'grid' -%}
  <div class="feature-panel__grid" role="list">
    {%- for item in safe_items -%}
      {%- if rendered_count >= max_items -%}{% break %}{%- endif -%}
      {%- render 'feature-panel.item', item: item, source: source -%}
      {%- assign rendered_count = rendered_count | plus: 1 -%}
    {%- endfor -%}
  </div>

{%- elsif mode == 'carousel' -%}
  <div class="feature-panel__carousel" data-feature-panel-carousel>
    <div class="feature-panel__track" role="list">
      {%- for item in safe_items -%}
        {%- if rendered_count >= max_items -%}{% break %}{%- endif -%}
        {%- render 'feature-panel.item', item: item, source: source -%}
        {%- assign rendered_count = rendered_count | plus: 1 -%}
      {%- endfor -%}
    </div>

    <button type="button" class="feature-panel__nav" data-action="prev" aria-label="Previous">
      ‹
    </button>
    <button type="button" class="feature-panel__nav" data-action="next" aria-label="Next">
      ›
    </button>
  </div>
{%- endif -%}

{%- if cta_url != blank and cta_label != blank -%}
  <div class="feature-panel__cta">
    <a class="button" href="{{ cta_url }}">{{ cta_label }}</a>
  </div>
{%- endif -%}
