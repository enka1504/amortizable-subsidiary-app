{%- comment -%}
  Advanced section:
  - Schema defines the public API (mode, source, limits)
  - Section is context-agnostic (works anywhere)
  - Blocks are data contracts ("item"), not fixed markup chunks
  - Performance: limit items, avoid unbounded loops, prefer image_url sizes
{%- endcomment -%}

{%- liquid
  assign mode = section.settings.mode
  assign source = section.settings.source
  assign max_items = section.settings.max_items | default: 6
-%}

<section
  class="feature-panel feature-panel--{{ mode }}"
  data-feature-panel
  data-section-id="{{ section.id }}"
  aria-label="{{ section.settings.aria_label | escape }}"
>
  {%- if section.settings.heading != blank -%}
    <header class="feature-panel__header">
      <h2 class="feature-panel__heading">{{ section.settings.heading }}</h2>
      {%- if section.settings.subheading != blank -%}
        <p class="feature-panel__subheading">{{ section.settings.subheading }}</p>
      {%- endif -%}
    </header>
  {%- endif -%}

  {%- comment -%}Resolve items based on selected data source{%- endcomment -%}
  {%- assign items = nil -%}

  {%- if source == 'blocks' -%}
    {%- assign items = section.blocks -%}
  {%- elsif source == 'metaobject' and section.settings.items_metaobject_list != blank -%}
    {%- comment -%}
      items_metaobject_list is a "list of metaobjects" setting.
      Each metaobject should have fields like: title, body, icon, link
    {%- endcomment -%}
    {%- assign items = section.settings.items_metaobject_list -%}
  {%- endif -%}

  {%- render 'feature-panel.render',
    mode: mode,
    source: source,
    items: items,
    max_items: max_items,
    cta_label: section.settings.cta_label,
    cta_url: section.settings.cta_url
  -%}
</section>

{%- comment -%}Load section-scoped JS only if behavior requires it{%- endcomment -%}
{%- if mode == 'carousel' -%}
  <script src="{{ 'feature-panel.js' | asset_url }}" defer></script>
{%- endif -%}

{% schema %}
{
  "name": "Feature panel (advanced)",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Why customers choose us"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subheading",
      "default": "Fast shipping, secure checkout, easy returns."
    },
    {
      "type": "text",
      "id": "aria_label",
      "label": "ARIA label",
      "default": "Store benefits"
    },

    {
      "type": "select",
      "id": "source",
      "label": "Content source",
      "default": "blocks",
      "options": [
        { "value": "blocks", "label": "Blocks" },
        { "value": "metaobject", "label": "Metaobject list" }
      ]
    },
    {
      "type": "metaobject_list",
      "id": "items_metaobject_list",
      "label": "Items (metaobjects)",
      "metaobject_type": "feature_item"
    },

    {
      "type": "select",
      "id": "mode",
      "label": "Layout mode",
      "default": "grid",
      "options": [
        { "value": "grid", "label": "Grid" },
        { "value": "carousel", "label": "Carousel" }
      ]
    },
    {
      "type": "range",
      "id": "max_items",
      "label": "Max items to render",
      "min": 2,
      "max": 12,
      "step": 1,
      "default": 6
    },

    {
      "type": "text",
      "id": "cta_label",
      "label": "CTA label",
      "default": "Learn more"
    },
    {
      "type": "url",
      "id": "cta_url",
      "label": "CTA URL"
    }
  ],
  "blocks": [
    {
      "type": "item",
      "name": "Item (data contract)",
      "settings": [
        {
          "type": "select",
          "id": "variant",
          "label": "Item style variant",
          "default": "default",
          "options": [
            { "value": "default", "label": "Default" },
            { "value": "compact", "label": "Compact" }
          ]
        },
        { "type": "text", "id": "title", "label": "Title", "default": "Fast shipping" },
        { "type": "richtext", "id": "body", "label": "Body", "default": "<p>Delivered in 2â€“4 business days.</p>" },

        { "type": "image_picker", "id": "icon", "label": "Icon" },
        { "type": "url", "id": "link", "label": "Optional link" },
        { "type": "text", "id": "link_label", "label": "Link label", "default": "Details" }
      ]
    }
  ],
  "max_blocks": 12,
  "presets": [
    {
      "name": "Feature panel (advanced)",
      "blocks": [{ "type": "item" }, { "type": "item" }, { "type": "item" }]
    }
  ]
}
{% endschema %}
